<div id="modalCatalogResource" class="modalCatalogResource">
    <div class="modalContainer">
        <div class="modalTitle">
            <h5 style="font-size: 1em; margin-top: 0px">
                <%=i18n.escapeRoom.steps.indications.front.catalog.addResource%>
            </h5>

            <span class="building-block-icon material-icons" onclick="toggleCatalogModal()"> close </span>

        </div>
        <div style="margin: 4rem"></div>
        <div class="sections">
        <section >
            <p class="title-section">Elementos de gamificación</p>
            <div class="btn-group">
                <button onclick='insertGamification(0,"countdown",{}, puzzleList)' class="resourceCatalogBtn">
                    <span class="building-block-icon material-icons"> add </span>
                    <p><%=i18n.escapeRoom.steps.indications.front.countdown%></p>
                    <img class="building-block-img" src="/images/countdown.png" />
                </button>
                <button onclick='insertGamification(0,"ranking",{}, puzzleList)' class="resourceCatalogBtn">
                    <span class="building-block-icon material-icons"> add </span>
                    <p><%=i18n.escapeRoom.steps.indications.front.ranking%></p>
                    <img class="building-block-img" src="/images/ranking.png" />
                </button>
                <button onclick='insertGamification(0,"progress",{}, puzzleList)' class="resourceCatalogBtn">
                    <span class="building-block-icon material-icons"> add </span>
                    <p><%=i18n.escapeRoom.steps.indications.front.progress%></p>
                    <span class="building-block-icon material-icons" style="color: var(--lightred);">
                        show_chart </span>
                </button>
            </div>
        </section>
        <section>
            <p class="title-section">Recursos interactivos vinculados a retos</p>
            <div class="resources-group">
                <%availableReusablePuzzles.forEach(puzzle => { %>
                     <div class="resource-card">
                        <img src="/images/keypad.png">
                        <button class="resourceCatalogBtn">
                            <span class="building-block-icon material-icons"> add </span>
                            <p><%=puzzle.name%></p>
                        </button>
                    </div>
                <% })%>
            </div>
        </section>

        <section>
            <p class="title-section">Escenarios 2D</p>
           <div class="resources-group">
            <div class="resource-card" id="scenery">
                <img src="/images/scenery.png">
                <button class="resourceCatalogBtn">
                    <span class="building-block-icon material-icons"> add </span>
                    <p>Escenarios 2D</p>
                </button>
            </div>
        </div>
        </section>
    </div>
    </div>
</div>
<div id="resourceCatalog" style="display:flex;align-items:end;flex-direction:column">
    <div style="width:100%">
        <div style="display: flex; justify-content:end; margin-bottom:0.2em; gap: 0.7rem">
                    <button class="building-block-bar-button lg-button newItemButton" onclick="toggleCatalogModal()">
                        <a href="#">
                            <span class="building-block-icon material-icons"> add </span>
                            <p>
                                <%=i18n.escapeRoom.steps.indications.front.catalog.addResource%>
                            </p>
                        </a>
                    </button>
                    <button class="building-block-bar-button lg-button newItemButton">
                        <a href="assets?mode=catalogView">
                            <span class="building-block-icon material-icons"> upload </span>
                            <p>
                                <%=i18n.escapeRoom.steps.indications.front.catalog.uploadFile%>
                            </p>
                        </a>
                    </button>

        </div>
    </div>
    <div class="tableContainer" >
        <table style="width:100%;table-layout:fixed;" class="tab-content catalog-container"
            id="myTabContent">
            <colgroup>
                <col span="1" style="width: 50%;">
                <col span="1" style="width: 15%;">
                <col span="1" style="width: 35%;">
            </colgroup>
            <tr class="tableTitlesContainer">

                <th>
                    <%=i18n.escapeRoom.steps.indications.front.catalog.table.name%>
                </th>
                <th>
                    <%=i18n.escapeRoom.steps.indications.front.catalog.table.type%>
                </th>
                <th> </th>

            </tr>
            <%if(endPoint==="team" ){reusablePuzzlesInstances.map(puzzle=> {%>
                <tr class="catalogItem">
                    <td>
                        
                        <p class="title">
                            <%=puzzle.name%>
                        </p>
                        
                    </td>
                    <td> <span class="building-block-icon material-icons" id="green"> videogame_asset </span>
                    </td>
                    <td>
                        <div class="button-group row-button">
                            <button class="listButton iconButton delete-button"
                                onclick='deleteReusablePuzzleInstance("<%=puzzle.id%>")'>
                                <span class="building-block-icon material-icons" id="delete">
                                    delete_outline </span>
                            </button>
                            <button class="listButton iconButton editButton"
                                onclick='editReusablePuzzleInstance("<%=puzzle.id%>")'>
                                <span class="building-block-icon material-icons" id="edit"> edit </span>
                            </button>
                            <button class="listButton linkButton" onclick='copyURl("<%=puzzle.id%>")'>
                                <span class="building-block-icon material-icons" id="link"> link </span>
                                <div class="tooltip-link"> Copiar enlace </div>
                                <div class="tooltip-link" id="link-copied">
                                    <%=i18n.escapeRoom.steps.indications.front.catalog.copied%>
                                </div>
                            </button>
                            <button class="sm-button addButton "
                                onclick='insertAndScrollContent(0,"catalog",{url:"<%=puzzle.url%>",config: "<%=puzzle.config%>"  mime:"<%=puzzle.mime%>"}, puzzleList)'>
                                <span class="building-block-icon material-icons" id="add"> add </span>
                                <p>
                                    <%=i18n.escapeRoom.steps.indications.front.catalog.addBlock%>
                                </p>
                            </button>
                        </div>
                    </td>
                </tr>
                <% })} %>
                    <% if(assets.length === 0) {%>
                        <tr class="catalogItem">
                            <td colspan="3" style="text-align: center; height:200px">
                                <p class="title">
                                    <%=i18n.escapeRoom.steps.indications.front.catalog.table.noResources%>
                                </p>
                            </td>
                        </tr>
                    <% } %>
                    <% assets.map(asset=> {%>
                        <% if (asset.mime.search(new RegExp(/image\/.*/))!==-1){ %>
                            <tr class="catalogItem" id=<%=asset.id%> >
                                <td>
                                    <p class="title">
                                        <%=asset.filename%>
                                    </p>
                                </td>
                                <td> <span class="building-block-icon material-icons" id="green"> image </span>
                                </td>
                                <td>
                                    <div class=" button-group row-button">
                                        <div class="overlay-trigger" data-id="<%=asset.id%>">
                                            <p class="text-overlay">¿Estás seguro de que quieres borrar este
                                                ítem?</p>
                                            <button class="deleteButton" type="button"
                                                onclick='overlayTriggerCatalog("<%=asset.id%>", true)'>cancelar</button>
                                            <button class="acceptButton" type="button"
                                                onclick='deleteAsset("<%=asset.id%>")'>aceptar</button>
                                        </div>
                                        <button class="listButton iconButton delete-button"
                                            onclick="overlayTriggerCatalog('<%=asset.id%>', false)" data-id="<%=asset.id%>">
                                            <span class="building-block-icon material-icons" id="delete">
                                                delete_outline </span>
                                        </button>
                                        <button class="listButton iconButton editButton"
                                            onclick='editAsset("<%=asset.id%>", "<%=asset.mime%>", "<%=asset.config%>")'>
                                            <span class="building-block-icon material-icons" id="edit"> edit
                                            </span>
                                        </button>
                                        <button class="listButton linkButton" onclick='copyURl("<%=asset.url%>")'>
                                            <span class="building-block-icon material-icons" id="link"> link
                                            </span>
                                            <div class="tooltip-link"> Copiar enlace </div>
                                            <div class="tooltip-link" id="link-copied">
                                                <%=i18n.escapeRoom.steps.indications.front.catalog.copied%>
                                            </div>
                                        </button>

                                        <button class="sm-button addButton"
                                            onclick='insertAndScrollContent(0,"catalog",{url:"<%=asset.url%>",config: "<%=asset.config%>",  mime:"<%=asset.mime%>"}, puzzleList)'>
                                            <span class="building-block-icon material-icons" id="add"> add
                                            </span>
                                            <p>
                                                <%=i18n.escapeRoom.steps.indications.front.catalog.addBlock%>
                                            </p>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            <% } else if (asset.mime.search(new RegExp(/video\/.*/))!==-1){ %>
                                <tr class="catalogItem" id=<%=asset.id%> >
                                    <td>
                                        <p class="title">
                                            <%=asset.filename%>
                                        </p>
                                    </td>
                                    <td> <span class="building-block-icon material-icons" id="red"> videocam
                                        </span> </td>
                                    <td>
                                        <div class=" button-group row-button">
                                            <div class=" overlay-trigger" data-id="<%=asset.id%>">
                                                <p class="text-overlay">¿Estás seguro de que quieres borrar este
                                                    archivo?</p>
                                                <button class="deleteButton" type="button"
                                                    onclick='overlayTriggerCatalog("<%=asset.id%>", true)'>cancelar</button>
                                                <button class="acceptButton" type="button"
                                                    onclick='deleteAsset("<%=asset.id%>")'>aceptar</button>
                                            </div>
                                            <button class="listButton iconButton delete-button"
                                                onclick="overlayTriggerCatalog('<%=asset.id%>', false)" data-id="<%=asset.id%>">
                                                <span class="building-block-icon material-icons" id="delete">
                                                    delete_outline </span>
                                            </button>
                                            <button class="listButton iconButton editButton"
                                                onclick='editAsset("<%=asset.id%>", "<%=asset.mime%>", "<%=asset.config%>")'>
                                                <span class="building-block-icon material-icons" id="edit"> edit
                                                </span>
                                            </button>
                                            <button class="listButton linkButton" onclick='copyURl("<%=asset.url%>")'>
                                                <span class="building-block-icon material-icons" id="link"> link
                                                </span>
                                                <div class="tooltip-link"> Copiar enlace </div>
                                                <div class="tooltip-link" id="link-copied">
                                                    <%=i18n.escapeRoom.steps.indications.front.catalog.copied%>
                                                </div>
                                            </button>
                                            <button class="sm-button addButton"
                                                onclick='insertAndScrollContent(0,"catalog",{url:"<%=asset.url%>",config: "<%=asset.config%>",  mime:"<%=asset.mime%>"}, puzzleList)'>
                                                <span class="building-block-icon material-icons" id="add"> add
                                                </span>
                                                <p>
                                                    <%=i18n.escapeRoom.steps.indications.front.catalog.addBlock%>
                                                </p>
                                            </button>
                                        </div>
                                    </td>
                                </tr>
                                <% } else if (asset.mime.search(new RegExp(/audio\/.*/))!==-1){ %>
                                    <tr class="catalogItem" id=<%=asset.id%> >
                                        <td>
                                            <p class="title">
                                                <%=asset.filename%>
                                            </p>
                                        </td>
                                        <td> <span class="building-block-icon material-icons " id="purple">
                                                music_note </span> </td>
                                        <td>
                                            <div class=" button-group row-button">
                                                <div class=" overlay-trigger" data-id="<%=asset.id%>">
                                                    <p class="text-overlay">¿Estás seguro de que quieres borrar
                                                        este
                                                        archivo?</p>
                                                    <button class="deleteButton" type="button"
                                                        onclick='overlayTriggerCatalog("<%=asset.id%>", true)'>cancelar</button>
                                                    <button class="acceptButton" type="button"
                                                        onclick='deleteAsset("<%=asset.id%>")'>aceptar</button>
                                                </div>
                                                <button class="listButton iconButton delete-button"
                                                    onclick="overlayTriggerCatalog('<%=asset.id%>', false)" data-id="<%=asset.id%>">
                                                    <span class="building-block-icon material-icons" id="delete">
                                                        delete_outline </span>
                                                </button>
                                                <button class="listButton iconButton editButton"
                                                    onclick='editAsset("<%=asset.id%>", "<%=asset.mime%>", "<%=asset.config%>")'>
                                                    <span class="building-block-icon material-icons" id="edit">
                                                        edit
                                                    </span>
                                                </button>
                                                <button class="listButton linkButton"
                                                    onclick='copyURl("<%=asset.url%>")'>
                                                    <span class="building-block-icon material-icons" id="link">
                                                        link
                                                    </span>
                                                    <div class="tooltip-link"> Copiar enlace </div>
                                                    <div class="tooltip-link" id="link-copied">
                                                        <%=i18n.escapeRoom.steps.indications.front.catalog.copied%>
                                                    </div>
                                                </button>
                                                <button class="sm-button addButton"
                                                    onclick='insertAndScrollContent(0,"catalog",{url:"<%=asset.url%>",config: "<%=asset.config%>",  mime:"<%=asset.mime%>"}, puzzleList)'>
                                                    <span class="building-block-icon material-icons" id="add">
                                                        add
                                                    </span>
                                                    <p>
                                                        <%=i18n.escapeRoom.steps.indications.front.catalog.addBlock%>
                                                    </p>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                    <% } else if (asset.mime.search(new RegExp(/application\/.*/))!==-1){ %>
                                        <tr class="catalogItem" id=<%=asset.id%> >
                                            <td>
                                                <p class=" title">
                                                    <%=asset.filename%>
                                                </p>
                                            </td>
                                            <td> <span class="building-block-icon material-icons" id="blue">
                                                    description </span> </td>
                                            <td>
                                                <div class=" button-group row-button">
                                                    <div class=" overlay-trigger" data-id="<%=asset.id%>">
                                                        <p class="text-overlay">¿Estás seguro de que quieres
                                                            borrar este
                                                            archivo?</p>
                                                        <button class="deleteButton" type="button"
                                                            onclick='overlayTriggerCatalog("<%=asset.id%>", true)'>cancelar</button>
                                                        <button class="acceptButton" type="button"
                                                            onclick='deleteAsset("<%=asset.id%>")'>aceptar</button>
                                                    </div>
                                                    <button class="listButton iconButton delete-button"
                                                        onclick="overlayTriggerCatalog('<%=asset.id%>', false)" data-id="<%=asset.id%>">
                                                        <span class="building-block-icon material-icons" id="delete">
                                                            delete_outline </span>
                                                    </button>
                                                    <button class="listButton iconButton editButton"
                                                        onclick='editAsset("<%=asset.id%>", "<%=asset.mime%>", "<%=asset.config%>")'>
                                                        <span class="building-block-icon material-icons" id="edit"> edit
                                                        </span>
                                                    </button>
                                                    <button class="listButton linkButton"
                                                        onclick='copyURl("<%=asset.url%>")'>
                                                        <span class="building-block-icon material-icons" id="link"> link
                                                        </span>
                                                        <div class="tooltip-link"> Copiar enlace </div>
                                                        <div class="tooltip-link" id="link-copied">
                                                            <%=i18n.escapeRoom.steps.indications.front.catalog.copied%>
                                                        </div>
                                                    </button>

                                                    <button class="sm-button addButton"
                                                        onclick='insertAndScrollContent(0,"catalog",{url:"<%=asset.url%>",config: "<%=asset.config%>",  mime:"<%=asset.mime%>"}, puzzleList)'>
                                                        <span class="building-block-icon material-icons" id="add"> add
                                                        </span>
                                                        <p>
                                                            <%=i18n.escapeRoom.steps.indications.front.catalog.addBlock%>
                                                        </p>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                        <% } else { %>
                                            <tr class="catalogItem" id=<%=asset.id%> >
                                                <td>
                                                    <p class="title">
                                                        <%=asset.filename%>
                                                    </p>
                                                    <div class=" button-group row-button">
                                                </td>
                                                <td> <span class="building-block-icon material-icons" id="gray">
                                                        question_mark </span> </td>
                                                <td>
                                                    <div class=" overlay-trigger" data-id="<%=asset.id%>">
                                                        <p class="text-overlay">¿Estás seguro de que quieres
                                                            borrar
                                                            este
                                                            archivo?</p>
                                                        <button class="delete-button" type="button"
                                                            onclick='overlayTriggerCatalog("<%=asset.id%>", true)'>cancelar</button>
                                                        <button class="acceptButton" type="button"
                                                            onclick='deleteAsset("<%=asset.id%>")'>aceptar</button>
                                                    </div>
                                                    <button class="listButton iconButton delete-button"
                                                        onclick='overlayTriggerCatalog("<%=asset.id%>")' data-id="<%=asset.id%>">
                                                        <span class="building-block-icon material-icons" id="delete">
                                                            delete_outline </span>
                                                    </button>
                                                    <button class="listButton iconButton editButton" disabled>
                                                        <span class="building-block-icon material-icons" id="edit">
                                                            edit
                                                        </span>
                                                    </button>
                                                    <button class="listButton linkButton"
                                                        onclick='copyURl("<%=asset.url%>")'>
                                                        <span class="building-block-icon material-icons" id="link">
                                                            link
                                                        </span>
                                                        <div class="tooltip-link"> Copiar enlace </div>
                                                        <div class="tooltip-link" id="link-copied">
                                                            <%=i18n.escapeRoom.steps.indications.front.catalog.copied%>
                                                        </div>
                                                    </button>
                                                    <button class="sm-button addButton" disabled> <span
                                                            class="building-block-icon material-icons" id="add">
                                                            add
                                                        </span>
                                                        <p>
                                                            <%=i18n.escapeRoom.steps.indications.front.catalog.addBlock%>
                                                        </p>
                                                    </button>
    </div>
    </td>

    </tr>
    <% } return null;%>
        <% }) %>
            </table>

</div>
<div style="display:flex; margin-top:0.5em; align-items:center; justify-content: end; gap: 0.7rem">
    <button class="building-block-bar-button lg-button theme-btn" style="display:flex;">
        <span class="building-block-icon material-icons">color_lens</span>
        <span class="theme-text">
            <%=i18n.escapeRoom.steps.indications.front.theme%>: <span id="theme-title">
                    <%=theme[0].toUpperCase() + theme.slice(1)%>
                </span>
        </span>
    </button>
    <button class="addButton text-block-add lg-button"  onclick="insertContentBlock()">
        <span class="building-block-icon material-icons"> add </span>
        <p>
            <%= i18n.escapeRoom.steps.indications.front.catalog.addText%>
        </p>
    </button>

</div>
<br>
<div style="display:flex; justify-content:center">
    <dialog id="editDialog">
        <form action="/escapeRoom/<%=escapeRoom.id%>/assets" method="POST">
        </form>
    </dialog>
    <dialog id="reusablePuzzleDialog">
        <form method="POST" action="../reusablePuzzleInstance">
            <label> Name </label>
            <input type="text" name="name" />
            <label> Description </label>
            <input type="text" name="description" />
            </br>
            <label> Puzzle type </label>
            <select name="reusablePuzzleId">
            </select>
            </br>
            <h2>Configuration</h2>
            <label> Input </label>
            <input type="text" name="config_a" />
            <label> Input </label>
            <input type="text" name="config_b" />
            <label> Input </label>
            <input type="text" name="config_c" />
            <label> Input </label>
            <input type="text" name="config_d" />
            <input type="submit" />
        </form>
    </dialog>
</div>

<script>
    function toggleCatalogModal() {
        const modal = $("#modalCatalogResource");
        if(modal.hasClass("active")) {
            $('body').css("overflow", "scroll");
        } else {
            $('body').css("overflow", "hidden");
            window.scrollTo(0, 0);
        }
        modal.toggleClass("active");

    }
    function editAsset(id, mime, config) {
        const configJSON = parseAssetConfig(mime, config);
        const dialog = $('#editDialog');
        const form = dialog.find('form');
        form.attr('action', `./asset/${id}`);
        form.empty();
        if (mime.search(imageRegex) !== -1) {
            form.append(`
                    <div class="containerBlocksEdit">
                        <div>
                           <p class="titleLabelEdit"> Medidas </p>
            <div class="editDialogForm">

            <div>
                <label for="height">Height</label>
                <div class="editUnit">
                    <input class="light" value="${configJSON.height ? configJSON.height : 0}" name="height"/>
                    <p> px </p>
                </div>
            </div>
            <div>
                <label for="width">Width</label>
                <div class="editUnit">
                    <input class="light" type="number" value="${configJSON.width ? configJSON.width : 0}"  name="width"/>
                    <p> px </p>
            </div>
            </div>
                        </div>
            </div>`

            );


        } else if (mime.search(videoRegex) !== -1) {
            form.append(`
            <div class="containerBlocksEdit">
            <div >
                <p class="titleLabelEdit"> Medidas </p>
                <div class="editDialogForm">
                <div>
                    <label for="height">Height</label>
                    <div class="editUnit">
                        <input class="light" type="number" value="${configJSON.height ? configJSON.height : 0}" name="height"/>
                        <p> px </p>
                    </div>
                 </div>
                <div>
                    <label for="width">Width</label>
                    <div class="editUnit">
                        <input class="light" type="number" value="${configJSON.width ? configJSON.width : 0}"  name="width"/>
                        <p> px </p>
                    </div>
                </div>
                </div>
                </div>
                <div>
                    <p class="titleLabelEdit"> Opciones </p>
                <div class="checkBoxEditContainer">
                    <div><label for="autoplay">Autoplay</label><input ${configJSON.autoplay ? "checked" : ""} type="checkbox" name="autoplay"/></div>
                    <div><label for="download">Dowloads</label><input ${configJSON.download ? "checked" : ""} type="checkbox" name="download"/></div>
                    <div><label for="controls">Controls</label><input  ${configJSON.controls ? "checked" : ""} type="checkbox" name="controls"/></div>
                </div>
                </div>
                </div>
                `);
        } else if (mime.search(audioRegex) !== -1) {
            form.append(`
                        <div class="containerBlocksEdit">
            <div>
                 <p class="titleLabelEdit"> Opciones </p>
                 <div>
                <label for="controls">Controls</label>
                <input type="checkbox" ${configJSON.controls ? "checked" : ""} name="controls"/>
            </div>
                 </div>`);
        } else if (mime.search(applicationRegex) !== -1) {
            form.append(`<div><label for="width">Height</label><input type="number" value="${configJSON.height ? configJSON.height : 0}" name="width"/>px</div>
                    <div><label for="height">Width</label><input type="number" value="${configJSON.width ? configJSON.width : 0}"  name="height"/>px</div>`);
        } else {
            return `<div>${item.name}</div>`;
        }
        form.append(`<input class="editButton submit" type="submit" value="<%=i18n.common.save%>">`);
        dialog.dialog({
            modal: true,
            resizable: false,
            width: window.innerWidth > 900 ? 860 : window.innerWidth * 0.8,
            height: "auto",
            show: {
                effect: "scale",
                duration: 400
            },
            hide: {
                effect: "scale",
                duration: 400
            },
        }).show()

    }
    function parseAssetConfig(mime, config) {
        if (!config) return {};
        let texts = config.split(';');
        configJSON = {};
        texts.forEach(text => {
            const data = text.split(':');
            configJSON[data[0]] = data[1];
        })
        if (mime.search(imageRegex) !== -1) {
            return {
                width: configJSON.width,
                height: configJSON.height
            }
        } else if (mime.search(videoRegex) !== -1) {
            return {
                width: configJSON.width,
                height: configJSON.height,
                controls: configJSON.controls,
                autoplay: configJSON.autoplay,
                download: configJSON.download
            }
        } else if (mime.search(audioRegex) !== -1) {
            return {
                controls: configJSON.controls,
                autoplay: configJSON.autoplay,
            }
        } else if (mime.search(applicationRegex) !== -1) {
            return {
                width: configJSON.width,
                height: configJSON.height,
            }
        } else {
            return `<div>${item.name}</div>`;
        }
    }

    function createPuzzle() {
        dialog.dialog({
            modal: true,
            resizable: false,
            width: window.innerWidth > 900 ? 860 : window.innerWidth * 0.8,
            height: "auto",
            show: {
                effect: "scale",
                duration: 400
            },
            hide: {
                effect: "scale",
                duration: 400
            },
        }).show()
    }

    function deleteReusablePuzzleInstance(id) {
        fetch(`/reusablePuzzleInstance/${id}`, {
            method: 'DELETE',
        }).then(response => {
            if (response.ok) {
                location.reload();
            }
        });
    }
    function editReusablePuzzleInstance(id) {
        console.log('Todo')
    }
    function copyURl(url) {
        navigator.clipboard.writeText(window.location.origin + url);

    }
    function insertContentBlock() {
        const text = `<p>${window.placeholder}</p>`
        insertAndScrollContent(0, 'text', { text }, puzzleList);
        window.scrollTo(0, $('.building-block').children().last().offset().top);
    }
    function insertAndScrollContent(index, type, payload, puzzles) {
        insertContent(index, type, payload, puzzles);
        window.scrollTo(0, $('.building-block').children().last().offset().top);
    }

    function insertGamification(index, type, payload, puzzles) {
        toggleCatalogModal();
        insertAndScrollContent(index, type, payload, puzzles);
    }

    function overlayTriggerCatalog(id, open) {
        //definir el elemento de la tabla
        const table = $(".tableContainer")

        const overlay = $('.overlay-trigger[data-id="' + id + '"]');
        overlay.hide();
        // definir el elemento de "delete" y capturar su posición
        const deleteButton = document.querySelector('.delete-button[data-id="' + id + '"]');
        console.log(deleteButton, " delete")
        const deletePosition = deleteButton.getBoundingClientRect()
  
        // todo lo de abajo se ejecuta si el modal está cerrado.
        if (!open) {
            // colocar el modal para que siempre esté dentro de la tabla
            // dependiendo de la posición del botón de borrado
            if (deletePosition.y <= 455) {
                overlay.css("transform", `translateY( 80px)`);
            } else {
                overlay.css("transform", `translateY( -80px)`);
            }
         
            overlay.show();

            // Ocultar overlay con click afuera
            // Espera un momento antes de agregar el listener, para evitar cierre inmediato
            setTimeout(() => {
                $(document).on('click.overlay', function (event) {
                    
                    // 1. Verifica si el clic NO fue directamente sobre el overlay.
                    if (!overlay.is(event.target) && overlay.has(event.target).length === 0) { //2. Verifica si el clic NO fue en un hijo del overlay.
                        overlay.hide();
                        table.removeClass("overflow-hidden");
                        $(document).off('click.overlay'); // Elimina el evento después de ocultar el overlay
                    }
                });
            }, 50);
            // 2. añadir/ eliminar clases en la tabla de hide
            table.addClass("overflow-hidden");
            console.log(table.hasClass("overflow-hidden"));
        }
        if (open) {
            table.removeClass("overflow-hidden");
        }
    }

</script>
