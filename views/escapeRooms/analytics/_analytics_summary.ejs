<script src="/js/apexcharts.js"></script>

<form method="get" class="participantsList" action="/escapeRooms/<%= escapeRoom.id %>/analytics/">
    <div class="filters">
        <label for="turnId"><%=i18n.turnos.Turno%>
            <select name="turnId" id="turnId">
                <option value="" <%= !turnId ? "selected": ""%> ><%=i18n.turnos.all%></option>
                <% for (t in escapeRoom.turnos) {
                    var turno = escapeRoom.turnos[t] ;
                    // if (turno.status !== "pending" ) {
                %>
                <option value="<%=turno.id%>" <%= turnId == turno.id ? "selected" : "" %> >
                    <%= getFullDate(turno.date)%>
                </option>
                <% // }
                } %>
            </select>
        </label>
        <button type="submit" class="filter-button white" ><%=i18n.common.filter%></button>

    </div>
</form>
<div class="card-container">
    <% var counter = 0;
            for (var k in summary) {%>
    <div class="card <%=k%> animated zoomIn  " style="animation-delay: <%=counter/5%>s;">
        <div class="card-icon"><i class="material-icons"><%=summary[k].icon%></i></div>
        <div class="card-title"><%=i18n.analytics.main.dashboard[k]%></div>
        <div class="card-content"><%=summary[k].value%></div>
    </div>
    <%counter++;
    }%>
</div>
<script>
  var bodyStyles = window.getComputedStyle(document.body);
  var cp = (prop) => bodyStyles.getPropertyValue(prop).trim();
  var puzzleColor = [
    cp('--lightred'),
    cp('--brightgreen'),
    cp('--brightyellow'),
    cp('--brightorange'),
    cp('--brightblue'),
    cp('--textpurple')]
</script>
<div class="chart-summary">

    <%for (var i in charts) {%>
    <div id="chart_<%=i%>">
    </div>
        <script>
          var nTeams = <%= charts[i].data.length %>
          var options = {
            chart: {
              height: 380,
              type: "bar",
              events: {
                click: function(chart, w, e){
                  console.log(chart, w, e )
                }
              },
            },
            colors: puzzleColor,
            plotOptions: {
              bar: {
                columnWidth: '70%',
                distributed: true
              }
            },
            dataLabels: {
              enabled: false,
            },
            series: [{
              name: '',
              data: <%- JSON.stringify(charts[i].data)%>
            }],
            xaxis: {
              categories:  <%- JSON.stringify(charts[i].labels)%>,
              labels: {
                style: {
                  colors: 'black',
                  fontSize: '14px'
                }
              }
            },
            yaxis: {
              show: true,
              tickAmount: nTeams,
              min: 0,
              max: nTeams,
              labels: {
                formatter: function (value) {
                  if (value == 1){
                    return value + " <%=i18n.team.team%>";
                  }
                  else {
                    return value + " <%=i18n.team.teams%>";
                  };
                },
                style: {
                  color: 'black'
                }
              }

            }
          };
          var chart = new ApexCharts(document.querySelector("#chart_<%=i%>"), options);
          chart.render();
        </script>
    <%}%>
</div>