<%- include ("../partials/_header.ejs") %>

<div role="main" class="main">

<table class="reportTable">
    <tr class="tableHeader">
        <td>Author</td>
        <td>Escape Room</td>
        <td>Reason</td>
        <td>A</td>
    </tr>
    <%reports.forEach(report => {%>
        <%if(report.readed === false){%>
           <tr id=<%=report.id%> class="info noreaded">
                <td><%= report.user.name%></td>
                <td><%= report.escapeRoom.title%></td>
                <td><%= i18n.reports[report.reason]%></td>
                <td>
                    <button class="Bnoreaded" onclick="markAsUnread('<%= report.id%>')">Mande</button>
                    <button class="Breaded" onclick="markAsRead('<%= report.id%>')">Oido cocina</button>
                    <button class="delete" onclick="deleteReport('<%= report.id%>')">Delete</button>
                </td>
           </tr>
           <tr id="<%=report.id%>-c" class="noreaded comments">
                <td class="comments" colspan="4"><%= report.comments%></td>
           <tr>
    <% }})%>
    <%reports.forEach(report => {%>
        <%if(report.readed === true){%>
           <tr id=<%=report.id%> class="readed info">
                <td><%= report.user.name%></td>
                <td><%= report.escapeRoom.title%></td>
                <td><%= i18n.reports[report.reason]%></td>
                <td>
                    <button class="Bnoreaded" onclick="markAsUnread('<%= report.id%>')">Mande</button>
                    <button class="Breaded" onclick="markAsRead('<%= report.id%>')">Oido cocina</button>
                    <button class="delete" onclick="deleteReport('<%= report.id%>')">Delete</button>
                </td>
           </tr>
           <tr id="<%=report.id%>-c" class="readed">
                <td class="comments" colspan="4"><%= report.comments%></td>
           <tr>
        <% }%>
    <% })%>
</table>
</div>

<style>
 .tableHeader {
    border-bottom: solid 1px white;
    font-weight: bold;
 }
.comments {
    border-bottom: solid 1px white;
    padding: 10px;
}
.reportTable {
    width: 100%;
    border-collapse: collapse;
}
.readed {
    color: #555;
}

.noreaded {
    color: #DDD;
}

.Breaded {
    background-color: #4CAF50;
}
.Bnoreaded {
    background-color: yellow;
}
.delete {
    background-color: #f44336;
}

</style>

<script>
    async function markAsRead(id) {
        console.log('si')
        const result = await fetch(`/reports/${id}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ readed: true })
        })
        if(result.ok) {
            const row = document.getElementById(id);
            const rowC = document.getElementById(id + '-c');
            row.classList.remove('noreaded');
            row.classList.add('readed');
            rowC.classList.remove('noreaded');
            rowC.classList.add('readed');
        }
    }

    async function markAsUnread(id) {
        console.log('no')
        const result = await fetch(`/reports/${id}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ readed: false })
        })
        if(result.ok) {
            const row = document.getElementById(id);
            const rowC = document.getElementById(id + '-c');
            row.classList.remove('readed');
            row.classList.add('noreaded');
            rowC.classList.remove('readed');
            rowC.classList.add('noreaded');
        }
    }

    async function deleteReport(id) {
        const result = await fetch(`/reports/${id}`, {
            method: 'DELETE',
        })
        if(result.ok) {
            const row = document.getElementById(id);
            const rowC = document.getElementById(id + '-c');
            row.remove();
            rowC.remove();
        }

    }
</script>
